source "$HOME/.dotfiles/bash/base.bash"
source "$HOME/.dotfiles/bash/prompt.bash"
source "$HOME/.dotfiles/bash/functions.bash"
source "$HOME/.dotfiles/functions.sh"
source "$HOME/.dotfiles/fzf-functions.sh"

# sensitive configs
[ -s "$HOME/.bashrc.local.bash" ] && source "$HOME/.bashrc.local.bash"

# base16 colors
if [[ "$TERM_BACKGROUND" = 'light' ]]; then
  source_if_exists "$HOME/.config/base16-shell/scripts/base16-default-light.sh"
elif [[ "$TERM_BACKGROUND" = 'dark' ]]; then
  source_if_exists "$HOME/.config/base16-shell/scripts/base16-tomorrow-night.sh"
else
  source_if_exists "$HOME/.config/base16-shell/scripts/base16-onedark.sh"
fi

# better dircolors
dircolors_bin=$(dircolors >/dev/null 2>&1 && echo 'dircolors' || echo 'gdircolors')
eval "$("$dircolors_bin" -b "$HOME/.LS_COLORS/LS_COLORS")"

# completion
source_if_exists "/usr/local/opt/git/etc/bash_completion.d/git-completion.bash"
complete -o default -o nospace -W "$(grep '^Host ' "$HOME/.ssh/config" | awk '{print $2}')" scp sftp ssh # complete ssh hosts

# fasd
fasd_cache="$HOME/.fasd-init-bash"
if [ "$(command -v fasd)" -nt "$fasd_cache" ] || [ ! -s "$fasd_cache" ]; then
  fasd --init posix-alias bash-hook bash-ccomp bash-ccomp-install >| "$fasd_cache"
fi
source "$fasd_cache"
unset fasd_cache

# fzf
source_if_exists "$HOME/.fzf.bash"
export FZF_DEFAULT_COMMAND='(git ls-tree -r --name-only HEAD || rg --files --no-ignore --hidden --follow) 2> /dev/null'
export FZF_DEFAULT_OPTS="--multi --tiebreak=end --bind alt-a:select-all,alt-d:deselect-all,alt-t:toggle-all --color=${TERM_BACKGROUND:-dark}"
export FZF_ALT_C_OPTS="--preview 'tree -C {} | head -200'"

# lazy loaders
lazy_load "NVM"    "$HOME/.nvm/nvm.sh"                 "nvm grunt node npm"
lazy_load "SDKMAN" "$HOME/.sdkman/bin/sdkman-init.sh"  "gradle"
lazy_load "RVM"    "$HOME/.rvm/scripts/rvm"            "rvm pod bundle gem"
