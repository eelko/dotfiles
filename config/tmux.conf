# list plugins
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tpm'

# tmux-battery
set -g @batt_color_status_primary_attached 'default'
set -g @batt_color_status_primary_charging 'default'
set -g @batt_color_status_primary_charged 'default'
set -g @batt_color_charge_primary_tier1 '#ff0000' # 0%-5%
set -g @batt_color_charge_primary_tier2 '#ff4000' # 5%-20%
set -g @batt_color_charge_primary_tier3 '#ff8000' # 20%-35%
set -g @batt_color_charge_primary_tier4 '#ffff00' # 35%-50%
set -g @batt_color_charge_primary_tier5 'default' # 50%-65%
set -g @batt_color_charge_primary_tier6 'default' # 65%-80%
set -g @batt_color_charge_primary_tier7 'default' # 80%-95%
set -g @batt_color_charge_primary_tier8 'default' # 95%-100%
set -g @batt_color_charge_secondary_tier1 'default' # 0%-5%
set -g @batt_color_charge_secondary_tier2 'default' # 5%-20%
set -g @batt_color_charge_secondary_tier3 'default' # 20%-35%
set -g @batt_color_charge_secondary_tier4 'default' # 35%-50%
set -g @batt_color_charge_secondary_tier5 'default' # 50%-65%
set -g @batt_color_charge_secondary_tier6 'default' # 65%-80%
set -g @batt_color_charge_secondary_tier7 'default' # 80%-95%
set -g @batt_color_charge_secondary_tier8 'default' # 95%-100%

set -g @batt_icon_status_charged ''
set -g @batt_icon_charge_tier8 '' # 95%-100%
set -g @batt_icon_charge_tier7 '' # 80%-95%
set -g @batt_icon_charge_tier6 '' # 65%-80%
set -g @batt_icon_charge_tier5 '' # 50%-65%
set -g @batt_icon_charge_tier4 '' # 35%-50%
set -g @batt_icon_charge_tier3 '' # 20%-35%
set -g @batt_icon_charge_tier2 '' # 5%-20%
set -g @batt_icon_charge_tier1 '' # 0%-5%
set -g @batt_icon_status_attached ''
set -g @batt_icon_status_charging ''
set -g @batt_icon_status_discharging ''

# tmux-cpu
set -g @cpu_low_fg_color '#[fg=default]'
set -g @cpu_medium_fg_color '#[fg=colour202]'
set -g @cpu_high_fg_color '#[fg=colour196]'

set -g @cpu_low_icon ''
set -g @cpu_medium_icon ''
set -g @cpu_high_icon ''

# tmux-prefix-highlight
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_show_sync_mode 'on'

set -g @prefix_highlight_copy_prompt 'COPY'
set -g @prefix_highlight_empty_prompt ' TMUX '
set -g @prefix_highlight_prefix_prompt '^SPC'
set -g @prefix_highlight_sync_prompt 'SYNC'

set -g @prefix_highlight_fg 'black'
set -g @prefix_highlight_bg 'green'
set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=yellow'
set -g @prefix_highlight_empty_attr 'fg=black,bg=blue'
set -g @prefix_highlight_sync_mode_attr 'fg=black,bg=cyan'

# key bindings
set -g prefix C-Space
set -g mode-keys vi
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
bind-key -T copy-mode-vi 'y' send-keys -X copy-pipe-and-cancel 'pbcopy'
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection -x
bind-key < swap-window -d -t ':-1'
bind-key > swap-window -d -t ':+1'
bind-key s split-window -v -c "#{pane_current_path}"
bind-key v split-window -h -c "#{pane_current_path}"

# Resize splits with purpose
bind-key -r 'Left'  resize-pane -L 63
bind-key -r 'Right' resize-pane -R 63
bind-key -r 'Up'    resize-pane -U 15
bind-key -r 'Down'  resize-pane -D 15

## Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n M-h if-shell "$is_vim" 'send-keys M-h' 'select-pane -L'
bind-key -n M-j if-shell "$is_vim" 'send-keys M-j' 'select-pane -D'
bind-key -n M-k if-shell "$is_vim" 'send-keys M-k' 'select-pane -U'
bind-key -n M-l if-shell "$is_vim" 'send-keys M-l' 'select-pane -R'

## split/join panes
bind-key b break-pane
bind-key j command-prompt -p "Join pane with:"  "join-pane -t:'%%'"

## rename pane
bind-key t command-prompt -p "(rename-pane)" -I "#T" "select-pane -T '%%'"

## toggle pane names
bind-key T run 'zsh -c "arr=( off top ) && tmux setw pane-border-status \${arr[\$(( \${arr[(I)#{pane-border-status}]} % 2 + 1 ))]}"'

## toggle synchronize-panes
bind-key S set synchronize-panes \; display "synchronize panes #{?synchronize-panes,ON,OFF}"

# status bar
set -g status-left '#{prefix_highlight} '
set -g status-right "#{cpu_fg_color} #{cpu_percentage} #{cpu_icon}  #{battery_color_fg}#{battery_percentage} #{battery_icon}#[default]  #(date '+%a %b %e %l:%M %p' | sed -E 's/\s{2}/\s/g')  "

set -g status-right-length 60
set -g status-right-style 'fg=colour244,bg=colour00'
set -g status-style 'fg=colour244,bg=colour00'

# window status
set -g window-status-format "#[fg=default] #I #W"
set -g window-status-current-format "#[fg=#B5D8F6,bg=default] #I #W#F#[default]"
set -g window-status-separator " "
set -g status-justify left

# windows and panes
set -g base-index 1 # start windows at 1, not 0
set -g pane-base-index 1 # start panes at 1, not 0
set -g window-active-style 'fg=white,bg=black' # active window
set -g window-style 'fg=colour247,bg=#3a3a3a' # inactive window
set -g pane-active-border-style 'fg=colour235,bg=colour235'
set -g pane-border-style 'fg=colour235,bg=colour235'
set -g pane-border-format "#{?pane_active,#[reverse],}#{pane_index}#[default] #{pane_title} #{pane_current_command}" # set pane title to running command

# pane names
set -g automatic-rename on
set -g automatic-rename-format '#{b;s/#(whoami)/~/:pane_current_path}:#{pane_current_command}'

# general options
set -g default-shell $SHELL
set -g monitor-activity on
set -g mouse on # when this is ON, mouse select/copy requires alt/option to be pressed while selecting text
set -g set-titles on
set -g window-status-activity-style none
set -g word-separators ' -_@"=:,.()[]{}/'

# add truecolor support
set -g default-terminal 'alacritty'
set -sa terminal-overrides ',alacritty:RGB'
set -sa terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m' # underscore colors (needs tmux 3+)

# TokyoNight theme colors
set -gu window-active-style # active window
set -gu window-style # inactive window
set -g pane-active-border-style "fg=#080808,bg=#24283b"
set -g pane-border-style "fg=#080808,bg=#24283b"
set -g status-style "fg=#7aa2f7,bg=#24283b"
set -g status-left-style NONE
set -g status-right-style NONE

# install tpm if needed
if "test ! -d ~/.tmux/plugins/tpm" \
  "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
